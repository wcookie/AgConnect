<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>


<form>
  <label><input type="checkbox" name="mode" value="precip" checked>Precipitation</label>
  <label><input type="checkbox" name="mode" value="temp" checked>Temperature (F)</label>
  <label><input type="checkbox" name="mode" value="tons">Total Yield (Tons)</label>
  <label><input type="checkbox" name="mode" value="tons-field">Avg. Yield (Tons/Field)</label>
  <label><input type="checkbox" name="mode" value="profit" checked>Profit ($/Field)</label>
  <label><input type="submit" value="SUBMIT" checked></label>
</form>


<body>

    
    <div id="chart"></div>
    <script type="text/javascript">

    //alert(stuff);
    //stuff=JSON.parse(stuff);
    //var stuff=    [{'month': [0.9666666666666667, 58.405, 272000, 16036000]}, {'month': [1.159166666666667, 59.07999999999999, 255000, 27823000]}, {'month': [1.2408333333333337, 58.65500000000001, 39218, 7534733]}, {'month': [1.2962500000000003, 54.70750000000001, 170000, 35624000]}, {'month': [1.3081666666666671, 53.23000000000001, 158000, 37337000]}, {'month': [1.354444444444445, 54.56985915492958, 124000, 48969000]}, {'month': [1.3678571428571433, 55.6688888888889, 140000, 67748000]}, {'month': [1.2977083333333337, 56.350967741935506, 23230, 12247352]}, {'month': [1.2913888888888894, 55.46800000000002, 180000, 51819000]}, {'month': [1.2787500000000003, 54.98307692307695, 100000, 47131000]}]
    var data = [
    {
        "month" : [10, 30, 1000, 121]
    },
    {
        "month" : [20, 50, 10000, 121]
    },
    {
        "month" : [30, 10, 7, 121]
    },
    {
        "month" : [40, 50, 90, 121]
    },
    {
        "month" : [60, 70, 198, 121]
    },
    {
        "month" : [100, 40, 473, 121]
    },
    {
        "month" : [50, 30, 298, 121]
    },
    {
        "month" : [40, 50, 19, 121]
    },
    {
        "month" : [30, 60, 23, 121]
    },
    {
        "month" : [50, 80, 133, 121]
    },
    {
        "month" : [60, 90, 1235, 121]
    },
    {
        "month" : [80, 100, 14, 121]
    },
    
    ]



    function graphs(h, w, ii, jj, kk, d) {

    var jsonData = d;

    var height = h,
        width = w;

    var yMax0 = d3.max(jsonData.map(function(d) {
        return d.month[ii];
    }));

    var yScale0 = d3.scale.linear()
            .domain([0, yMax0])
            .range([0, height]);

    var yMax1 = d3.max(jsonData.map(function(d) {
        return d.month[jj];
    }));

    var yScale1 = d3.scale.linear()
            .domain([0, yMax1])
            .range([0, height]);

    var yMax2 = d3.max(jsonData.map(function(d) {
        return d.month[kk];
    }));

    var yScale2 = d3.scale.linear()
            .domain([0, yMax2])
            .range([0, height]);

    var xScale = d3.scale.ordinal()
            .domain(d3.range(0, jsonData.length))
            .rangeBands([0, width]);

    var xoffset = xScale.rangeBand()/4;

    var tooltip = d3.select("body").append("div")
        .style("position", "absolute")
        .style("padding", "0 10px")
        .style("background", "white")
        .style("opacity", 0);

    var sampleSVG = d3.select("#chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height);    

    sampleSVG.selectAll(".blue.rect").data(jsonData)
        .enter().append("rect")
            .attr("class", "blue rect")
            .style("stroke", "gray")
            .style("fill", "#AEC6CF")
            .attr("width", xScale.rangeBand()/4)
            .attr("height", function(d){
                return yScale0(d.month[ii]);
            })
            .attr("x", function(d,i){
                return xScale(i);
            })
            .attr("y", function(d){
                return height - yScale0(d.month[ii]);
            })
            .on("mouseover", function(d){
                tooltip.transition()
                    .style("opacity", .9);

                tooltip.html(d.month[ii])
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY) + "px");

                d3.select(this).style("fill", "blue");
            })
            .on("mouseout", function(){
                d3.select(this).style("fill", "#AEC6CF");

                tooltip.transition()
                    .style("opacity", 0);
            });

    sampleSVG.selectAll(".red.rect").data(jsonData)
        .enter().append("rect")
            .attr("class", "red rect")
            .style("stroke", "gray")
            .style("fill", "#FF7878")
            .attr("width", xScale.rangeBand()/4)
            .attr("height", function(d){
                return yScale1(d.month[jj]);
            })
            .attr("x", function(d,i){
                return xScale(i) + xoffset;
            })
            .attr("y", function(d){
                return height - yScale1(d.month[jj]);
            })
            .on("mouseover", function(d){
                tooltip.transition()
                    .style("opacity", .9);

                tooltip.html(d.month[jj])
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY) + "px");

                d3.select(this).style("fill", "red");
            })
            .on("mouseout", function(){
                d3.select(this).style("fill", "#FF7878");

                tooltip.transition()
                    .style("opacity", 0);
            });

    sampleSVG.selectAll(".green.rect").data(jsonData)
        .enter().append("rect")
            .attr("class", "green rect")
            .style("stroke", "gray")
            .style("fill", "#89E894")
            .attr("width", xScale.rangeBand()/4)
            .attr("height", function(d){
                return yScale2(d.month[kk]);
            })
            .attr("x", function(d,i){
                return xScale(i) + 2*xoffset;
            })
            .attr("y", function(d){
                return height - yScale2(d.month[kk]);
            })
            .on("mouseover", function(d){
                tooltip.transition()
                    .style("opacity", .9);

                tooltip.html(d.month[kk])
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY) + "px");
                    
                d3.select(this).style("fill", "green");
            })
            .on("mouseout", function(){
                d3.select(this).style("fill", "#89E894");

                tooltip.transition()
                    .style("opacity", 0);
                });
        }


    var myDjangoList = (("{{stuff |safe}}").replace(/&(l|g|quo)t;/g, function(a,b){
            return {
                l   : '<',
                g   : '>',
                quo : '"'
            }[b];
        }));

myDjangoList = myDjangoList.replace(/u'/g, '\'')
myDjangoList = myDjangoList.replace(/'/g, '\"')

var myData = JSON.parse( myDjangoList );
    graphs(800, 1000, 0, 1, 3, myData);
    
    </script>
</body>
</html>